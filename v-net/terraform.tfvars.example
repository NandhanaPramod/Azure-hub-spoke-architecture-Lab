# Azure region where resources will be created
location = "ukwest"

# Environment name (e.g., dev, prod, non-prod)
environment = "non-prod"
basename    = "spoke"

# VNet CIDR block
vnet_cidr = ["172.16.0.0/16"]

# Subnet configurations
subnets = {
  web = {
    name             = "web-subnet"
    address_prefixes = ["172.16.1.0/24"]
    nsg_name         = "web-nsg"
  }
  app = {
    name             = "app-subnet"
    address_prefixes = ["172.16.2.0/24"]
    nsg_name         = "app-nsg"
  }
  data = {
    name             = "data-subnet"
    address_prefixes = ["172.16.3.0/24"]
    nsg_name         = "data-nsg"
  }
}

# Security rules
security_rules = [
  {
    name                       = "AllowVnetInBound"
    priority                   = 100
    direction                  = "Inbound"
    access                     = "Allow"
    protocol                   = "*"
    source_port_range          = "*"
    destination_port_range     = "*"
    source_address_prefix      = "VirtualNetwork"
    destination_address_prefix = "VirtualNetwork"
  },
  {
    name                       = "AllowAzureLoadBalancerInBound"
    priority                   = 110
    direction                  = "Inbound"
    access                     = "Allow"
    protocol                   = "*"
    source_port_range          = "*"
    destination_port_range     = "*"
    source_address_prefix      = "AzureLoadBalancer"
    destination_address_prefix = "*"
  },
  {
    name                       = "DenyAllInBound"
    priority                   = 4096
    direction                  = "Inbound"
    access                     = "Deny"
    protocol                   = "*"
    source_port_range          = "*"
    destination_port_range     = "*"
    source_address_prefix      = "*"
    destination_address_prefix = "*"
  }
]

# Network security groups
security_group = [
  {
    name = "app-nsg"
    rule = ["AllowVnetInBound", "AllowAzureLoadBalancerInBound", "DenyAllInBound"]
  },
  {
    name = "data-nsg"
    rule = ["AllowVnetInBound", "AllowAzureLoadBalancerInBound", "DenyAllInBound"]
  },
  {
    name = "web-nsg"
    rule = ["AllowVnetInBound", "AllowAzureLoadBalancerInBound", "DenyAllInBound"]
  }
]

# Routes
routes = [
  {
    name_prefix            = "internet"
    name_postfix           = ["route"]
    address_prefix         = "0.0.0.0/0"
    next_hop_type          = "VirtualNetworkGateway"
    next_hop_in_ip_address = null
  }
]

# DDoS protection
ddos_name = "ddos-protection"
ddos_resource_group = "ddos-hub"

# Resource group creation
create_resource_group = true

# Default tags
default_tags = {
  Environment = "non-prod"
  Project     = "spoke-architecture"
  ManagedBy   = "terraform"
}

# Optional: Key Vault configuration
# key_vault_name = "your-key-vault-name"
# key_vault_resource_group = "your-key-vault-rg"

# Optional: Subscription ID
# subscription_id = "your-subscription-id" 